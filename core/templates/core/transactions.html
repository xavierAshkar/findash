{% extends "base_app.html" %}


{% block title %}Transactions{% endblock %}


{% block header %}
  <div class="flex items-center justify-between w-full">
    <h1 class="text-[32px] font-bold">Transactions</h1>


    <div class="flex gap-[12px] ">
      <form
        hx-post="{% url 'plaid:fetch_transactions' %}"
        hx-swap="none"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-on="htmx:afterOnLoad: window.location.reload()"
      >
        <button
          type="submit"
          class="text-[16px] px-[12px] py-[6px] font-semibold rounded-md bg-cardHeader border-[2px] border-transparent hover:bg-hoverBg hover:border-cardHeader hover:shadow transition cursor-pointer"
        >
          Sync Transactions
        </button>
      </form>
    </div>
  </div>
{% endblock %}


{% block content %}
  {% if transactions %}
  <ul class="space-y-4">
    {% for txn in transactions %}
      <li class="bg-white shadow rounded p-4">
        <div class="font-semibold text-lg">{{ txn.name }}</div>
        <div class="text-sm text-gray-500">
          {{ txn.date }} • {{ txn.account.name }}
        </div>
        <div class="mt-1 text-sm text-blue-400">
          Category:
          {% if txn.category_main %}
            {{ txn.category_main }}
          {% elif txn.user_tag %}
            {{ txn.user_tag }}
          {% else %}
            Uncategorized
          {% endif %}
        </div>
        <div class="mt-2 font-medium {% if txn.amount > 0 %}text-red-600{% else %}text-green-600{% endif %}">
          ${{ txn.amount }}
        </div>


        <!-- Add tag form -->
        <form method="post" action="{% url 'core:tag_transaction' txn.id %}" class="mt-3">
          {% csrf_token %}
          <label class="text-sm text-gray-600 block">Tag this transaction:</label>
          <div class="flex items-center gap-2 mt-1">
            <input type="text" name="tag" value="{{ txn.user_tag|default:'' }}" placeholder="e.g. groceries" class="border border-gray-300 p-2 rounded w-full bg-white text-black"
              class="border px-2 py-1 rounded text-sm w-48" />
            <button type="submit" class="text-sm bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">Save</button>
          </div>
        </form>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-gray-600">You don’t have any transactions to show.</p>
{% endif %}


{% endblock %}