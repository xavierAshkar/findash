{% extends "base_app.html" %}

{% block title %}Accounts{% endblock %}

{% block header %}
  <div class="flex items-center justify-between w-full">
    <h1 class="text-[32px] font-bold">Accounts</h1>

    <div class="flex gap-[12px] ">
      <form
        hx-post="{% url 'plaid:fetch_accounts' %}"
        hx-swap="none"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
      >
        <button
          type="submit"
          class="text-[16px] px-[12px] py-[6px] font-semibold rounded-md bg-cardHeader border-[2px] border-transparent hover:bg-hoverBg hover:border-cardHeader hover:shadow transition cursor-pointer"
        >
          Refresh all
        </button>
      </form>

      <a
        href="{% url 'plaid:link_account' %}"
        class="text-[16px] px-[12px] py-[6px] font-semibold rounded-md bg-accent text-white hover:bg-opacity-70 transition"
      >
        + Add account
      </a>
    </div>
  </div>
{% endblock %}

{% block content %}
{% if accounts %}
<div class="flex gap-[18px]">
  <!-- Left Column (Assets) -->
  <div class="w-1/2 flex flex-col gap-[18px]">

    <!-- Assets Summary -->
    <div class="w-full rounded-xl shadow-xl overflow-hidden">
      <div class="bg-cardHeader px-[16px] py-[12px] flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold text-white">Assets</h3>
          <p class="text-sm text-green-500">+2.0% <span class="text-textSubtle ml-2">1 month change</span></p>
        </div>
        <p class="text-lg font-semibold text-white">${{ total_assets|floatformat:2 }}</p>
      </div>
    </div>

    <!-- Checking -->
    <div class="w-full rounded-xl shadow-xl overflow-hidden">
      <div class="bg-cardHeader px-[16px] py-[12px] flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold text-white">Checkings</h3>
          <p class="text-sm text-green-500">+2.4% <span class="text-textSubtle ml-2">1 month change</span></p>
        </div>
        <p class="text-lg font-semibold text-white">${{ total_checking|floatformat:2 }}</p>
      </div>
      <ul class="bg-cardBg px-[16px] py-[12px] space-y-[12px]">
        {% for account in accounts %}
          {% if account.subtype == "checking" %}
            <li class="flex justify-between items-center">
              <div>
                <p class="text-base text-white">{{ account.name }}</p>
                <p class="text-sm text-textSubtle">•••• {{ account.mask }}</p>
              </div>
              <p class="text-white text-base">${{ account.current_balance|floatformat:2 }}</p>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

    <!-- Savings -->
    <div class="w-full rounded-xl shadow-xl overflow-hidden">
      <div class="bg-cardHeader px-[16px] py-[12px] flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold text-white">Savings</h3>
          <p class="text-sm text-green-500">+4.1% <span class="text-textSubtle ml-2">1 month change</span></p>
        </div>
        <p class="text-lg font-semibold text-white">${{ total_savings|floatformat:2 }}</p>
      </div>
      <ul class="bg-cardBg px-[16px] py-[12px] space-y-[12px]">
        {% for account in accounts %}
          {% if account.subtype == "savings" %}
            <li class="flex justify-between items-center">
              <div>
                <p class="text-base text-white">{{ account.name }}</p>
                <p class="text-sm text-textSubtle">•••• {{ account.mask }}</p>
              </div>
              <p class="text-white text-base">${{ account.current_balance|floatformat:2 }}</p>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

  </div>

  <!-- Right Column (Liabilities) -->
  <div class="w-1/2 flex flex-col gap-[18px]">

    <!-- Liabilities Summary -->
    <div class="w-full rounded-xl shadow-xl overflow-hidden">
      <div class="bg-cardHeader px-[16px] py-[12px] flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold text-white">Liabilities</h3>
          <p class="text-sm text-red-500">-3.7% <span class="text-textSubtle ml-2">1 month change</span></p>
        </div>
        <p class="text-lg font-semibold text-white">${{ total_liabilities|floatformat:2 }}</p>
      </div>
    </div>

    <!-- Credit Cards -->
    <div class="w-full rounded-xl shadow-xl overflow-hidden">
      <div class="bg-cardHeader px-[16px] py-[12px] flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold text-white">Credit Cards</h3>
          <p class="text-sm text-red-500">-3.7% <span class="text-textSubtle ml-2">1 month change</span></p>
        </div>
        <p class="text-lg font-semibold text-white">${{ total_credit|floatformat:2 }}</p>
      </div>
      <ul class="bg-cardBg px-[16px] py-[12px] space-y-[12px]">
        {% for account in accounts %}
          {% if account.type == "credit" %}
            <li class="flex justify-between items-center">
              <div>
                <p class="text-base text-white">{{ account.name }}</p>
                <p class="text-sm text-textSubtle">•••• {{ account.mask }}</p>
              </div>
              <p class="text-white text-base">${{ account.current_balance|floatformat:2 }}</p>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

  </div>
</div>
{% else %}
  <p class="text-gray-600">You don’t have any linked accounts yet.</p>
{% endif %}
{% endblock %}
